name: Deploy

on:
  push:
    branches: ["main", "251119"] # ë°°í¬ë¥¼ ì›í•˜ëŠ” ëª¨ë“  ë¸Œëœì¹˜ ì§€ì •
  workflow_dispatch:

permissions:
  contents: write # íŒŒì¼ ì“°ê¸° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤ (ê¸°ì¡´ 'read'ì—ì„œ ìˆ˜ì •ë¨)
  pages: write
  id-token: write

jobs:
  deploy:
    environment:
      name: github-pages

    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v5 # ìµœì‹  ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

      - name: Use Node.js 22.x
        uses: actions/setup-node@v4
        with:
          node-version: 22.x

      - name: Install dependencies
        run: npm install

      - name: Build and inject environment variables ğŸš€
        run: npm run build
        # ğŸŒŸ í•µì‹¬: Secretsê³¼ Varsë¥¼ ë¹Œë“œ ë‹¨ê³„ì˜ í™˜ê²½ ë³€ìˆ˜ë¡œ ì§ì ‘ ì£¼ì…
        env:
          VITE_NAVER_MAP_CLIENT_ID: ${{ secrets.VITE_NAVER_MAP_CLIENT_ID }}
          VITE_KAKAO_SDK_JS_KEY: ${{ secrets.VITE_KAKAO_SDK_JS_KEY }}
          VITE_SERVER_URL: ${{ vars.VITE_SERVER_URL }}
          VITE_STATIC_ONLY: ${{ vars.VITE_STATIC_ONLY }}

      - name: Deploy to gh-pages
        # ğŸ“Œ JamesIves ì•¡ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë” ê°„ê²°í•˜ê²Œ ë°°í¬í•©ë‹ˆë‹¤.
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: build # ğŸ‘ˆ ë¹Œë“œ ê²°ê³¼ í´ë”ë¥¼ í™•ì¸í•˜ì„¸ìš”. (Viteì˜ ê¸°ë³¸ê°’ì€ distì…ë‹ˆë‹¤. ë§Œì•½ buildë¼ë©´ buildë¡œ ìˆ˜ì •)
          clean: true
          token: ${{ secrets.GITHUB_TOKEN }}